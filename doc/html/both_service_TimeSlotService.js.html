<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: both/service/TimeSlotService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: both/service/TimeSlotService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {ValidationService} from "./ValidationService"

export class TimeSlotService {


        /**
         * @memberOf TimeSlotService
         * @summary For a given task, get time slot by _id
         * @locus Anywhere
         * @param task
         * @param timeSlotId
         * @returns {TimeSlot|null}
         */
        static getTimeSlot(task, timeSlotId) {
            if (typeof task !== "object")
                task = Tasks.findOne(task);
            var found;
            task.timeSlots.forEach(timeSlot => {
                if (timeSlot._id === timeSlotId) {
                    found = timeSlot;//TimeSlotService.read(timeSlot);
                    return false;
                }
            });
            return found;
        }

        /**
         * @memberOf TimeSlotService
         * @summary For a given task, get time slot index by _id
         * @locus Anywhere
         * @param task
         * @param timeSlotId
         * @returns {MongoId|null}
         */
        static getTimeSlotIndex(task, timeSlotId) {
            var found;
            var i = 0;
            task.timeSlots.forEach(timeSlot => {
                if (timeSlot._id === timeSlotId) {
                    found = i;
                    return false;
                }
                i++;
            });
            return found;
        }

        /**
         * @memberOf TimeSlotService
         * @summary Get one (several = false) or an array (several = true) of all item of availabilitiesOrTimeSlotsOrAssignments that start date is the same as start param
         * @locus Anywhere
         * @param availabilitiesOrTimeSlotsOrAssignments {Array&lt;Availability|TimeSlot|Assignment>}
         * @param start {Date}
         * @param several (default = false) {boolean}
         * @returns {Array&lt;TimeSlot> | TimeSlot  | null}
         */
        static getTimeSlotByStart(availabilitiesOrTimeSlotsOrAssignments, start, several = false) {
            if (several) {
                var found = [];
            } else {
                var found = null;
            }
            var startDate = new moment(new Date(start));
            availabilitiesOrTimeSlotsOrAssignments.forEach(thing => {
                //we only take the first matching timeSlot, le css ne sait aps encore gerer deux data timeSlot sur un meme calendar timeSlot
                if (startDate.isSame(new moment(new Date(thing.start)))) {
                    if (several) {
                        found.push(thing)
                    } else {
                        found = thing;
                        return false;
                    }
                }
            });
            return found;
        }


        /**
         * @memberOf TimeSlotService
         * @summary Get time slot by _id over all the Tasks (not very effective)
         * @locus Anywhere
         * @param timeSlotId {MondoId}
         * @returns {{timeSlot: *, task: *}}
         */
        static getTimeSlotById(timeSlotId) {
            var found;
            var taskFound;
            Tasks.find().fetch().forEach(task => {
                task.timeSlots.forEach(timeSlot => {
                    if (timeSlot._id === timeSlotId) {
                        found = timeSlot;//TimeSlotService.read(timeSlot);
                    }
                });
                if (!taskFound &amp;&amp; found)
                    taskFound = task;

            });


            return {
                timeSlot: found,
                task: taskFound
            };
        }

        /**
         * @memberOf TimeSlotService
         * @summary Give a people need _id, looks over all Tasks to find and return people need, time slot and task
         * @locus Anywhere
         * @param peopleNeedId {MondoId}
         * @returns {{timeSlot: TimeSlot, task: Task, peopleNeed: PeopleNeed}}
         */
        static getTaskAndTimeSlotAndPeopleNeedByPeopleNeedId(peopleNeedId) {
            var timeSlotFound;
            var taskFound;
            var peopleNeedFound;
            Tasks.find().fetch().forEach(task => {
               // if (!taskFound)
                    task.timeSlots.forEach(timeSlot => {
                     //   if (!timeSlotFound)
                            timeSlot.peopleNeeded.forEach(peopleNeed => {
                         //       if (!peopleNeed)
                                    if (peopleNeed._id === peopleNeedId) {
                                        peopleNeedFound = peopleNeed;
                                    }
                            });
                        if (!timeSlotFound &amp;&amp; peopleNeedFound)
                            timeSlotFound = timeSlot;
                    });
                if (!taskFound &amp;&amp; timeSlotFound)
                    taskFound = task;
            });

            return {
                timeSlot: timeSlotFound,
                task: taskFound,
                peopleNeed: peopleNeedFound
            };
        }

        /**
         * @memberOf TimeSlotService
         * @summary Give a people need assigned _id, looks over all Tasks to find and return people need assigned, time slot and task
         * @locus Anywhere
         * @param peopleNeedId {MondoId}
         * @returns {{timeSlot: TimeSlot, task: Task, peopleNeed: PeopleNeed}}
         */
        static getTaskAndTimeSlotAndAssignedPeopleNeedByAssignedPeopleNeedId(peopleNeedId) {
            var timeSlotFound;
            var taskFound;
            var peopleNeedFound;
            Tasks.find().fetch().forEach(task => {
                // if (!taskFound)
                task.timeSlots.forEach(timeSlot => {
                    //   if (!timeSlotFound)
                    timeSlot.peopleNeededAssigned.forEach(peopleNeed => {
                        //       if (!peopleNeed)
                        if (peopleNeed._id === peopleNeedId) {
                            peopleNeedFound = peopleNeed;
                        }
                    });
                    if (!timeSlotFound &amp;&amp; peopleNeedFound)
                        timeSlotFound = timeSlot;
                });
                if (!taskFound &amp;&amp; timeSlotFound)
                    taskFound = task;
            });

            return {
                timeSlot: timeSlotFound,
                task: taskFound,
                peopleNeed: peopleNeedFound
            };
        }

        static areTimeSlotOverlappingWithQuery(timeSlots,start,end,queryTimeSlotId){
            var okGod = true;
            timeSlots.forEach(_.bind(function (timeSlot) {
                if (!okGod || timeSlot._id === queryTimeSlotId)
                    return;

                //TODO ce n'est pas un overlapp !
                if (new moment(start).isBetween(timeSlot.start, timeSlot.end) ||
                    new moment(end).isBetween(timeSlot.start, timeSlot.end))
                    okGod = false;

            }, this));

            return okGod
        }

        static schemaCustomTimeSlot(schemaContext){
            //TODO $pull request doesn't use schema.custom...
            if (schemaContext.isUpdate) {
                var task = Tasks.findOne(schemaContext.docId);
                if(!ValidationService.isUpdateAllowed(task.timeSlotValidation.currentState)){
                    return "updateNotAllowed"
                }
            }

        }
    }
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_.html"></a></li><li><a href="AssignmentServiceClient.html">AssignmentServiceClient</a></li><li><a href="InjectDataServerService.html">InjectDataServerService</a></li><li><a href="Leaf.html">Leaf</a></li><li><a href="SecurityServiceClient.html">SecurityServiceClient</a></li><li><a href="SecurityServiceServer.html">SecurityServiceServer</a></li><li><a href="ServerAssignmentService.html">ServerAssignmentService</a></li><li><a href="ServerReferenceCollectionsService.html">ServerReferenceCollectionsService</a></li><li><a href="ServerTaskService.html">ServerTaskService</a></li><li><a href="ServerUserService.html">ServerUserService</a></li></ul><h3>Namespaces</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="EasySearch.html">EasySearch</a></li><li><a href="Enum.html">Enum</a></li><li><a href="Meteor%2520Methods.html">Meteor Methods</a></li><li><a href="Meteor_Publish.html">Meteor_Publish</a></li><li><a href="Route.html">Route</a></li><li><a href="Route.Assignment.html">Assignment</a></li><li><a href="Route.Assignment.taskToUser.html">taskToUser</a></li><li><a href="Route.Assignment.userToTask.html">userToTask</a></li><li><a href="Route.collectionReference.html">collectionReference</a></li><li><a href="Route.common.html">common</a></li><li><a href="Route.Task.html">Task</a></li><li><a href="Route.User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jun 20 2016 16:36:23 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
