<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/routes/assignment/route-assignment.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/routes/assignment/route-assignment.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {AssignmentServiceClient} from "../../../client/service/AssignmentServiceClient"
import {SecurityServiceClient} from "../../../client/service/SecurityServiceClient"
import {AssignmentReactiveVars} from "../../../client/helpers-events/assignment/AssignmentReactiveVars"

/**
 * @memberOf Route
 * @namespace Route.Assignment
 */

assignmentCalendarIsRendered = false;

AssignmentController = RouteController.extend({
    onBeforeAction: function () {
        SecurityServiceClient.grantAccessToPage(Meteor.userId(), RolesEnum.ASSIGNMENTTASKUSER, "assignment");

        if (!assignmentCalendarIsRendered) {
            this.render('AssignmentHomeWrapper', {to: 'mainContent'});
            this.render("AssignmentMenuWrapper", {to: "topNavBar"})
            assignmentCalendarIsRendered = true;
        }

        this.next();

    },

    onAfterAction: function () {
        //trick to perform the following on another 'thread' which has access to DOM
        setTimeout(function () {
            AssignmentServiceClient.initAssignmentSkillsFilter();
            AssignmentServiceClient.initAssignmentPopover();

            AssignmentServiceClient.disableDisplayAssignedCheckbox();

        }, 200);
    }
});

/**
 * @memberOf Route.Assignment
 * @summary Display assignment screen (calendar + task list + user list)
 * @locus client
 * @name 'assignment.calendar'  /assignment
 */
Router.route('/assignment', function () {
        console.info("routing", '/assignment');

        AssignmentReactiveVars.CurrentAssignmentType.set(AssignmentType.ALL);
    }, {
        controller: 'AssignmentController',
        name: 'assignment.calendar',
    }
);

/**
 * @memberOf Route.Assignment
 * @summary Redirect to /assignment/userToTask/:userId
 * @locus client
 * @name 'assignment.calendar.user'  /assignment/user/:userId
 */
Router.route('/assignment/user/:userId', function () {
        console.info("routing", '/assignment/user/' + this.params.userId);

        //desactivation de la recherche par URL
        //if (this.params.userId === "search") {
        //    console.info("routing error, misunderstanding 'search' as a userId");
        //    Router.go("/assignment");
        //}

        //ceci est seulement le userToTask => TODO faire le taskToUser

        this.wait(Meteor.subscribe('users', this.params.userId));

        if (this.ready()) {
            Router.go("/assignment/userToTask/" + this.params.userId);
        } else {
            console.log("Route /assignemnt/user/:userId : waiting user data"); //TODO add a spinner
        }

    }, {
        controller: 'AssignmentController',
        name: 'assignment.calendar.user'
    }
);

/**
 * @memberOf Route.Assignment
 * @summary Redirect to /assignment/taskToUser/:taskId
 * @locus client
 * @name 'assignment.calendar.task'  /assignment/task/:taskId
 */
Router.route('/assignment/task/:taskId', function () {
        console.info("routing", '/assignment/task/' + this.params.taskId);

        //desactivation de la recherche par URL
        //if (this.params.taskId === "search") {
        //    console.info("routing error, misunderstanding 'search' as a taskId");
        //    Router.go("/assignment");
        //}

        //ceci est seulement le taskToUser => faire le  userToTask

        this.wait(Meteor.subscribe('tasks', this.params.taskId));

        if (this.ready()) {
            Router.go("/assignment/taskToUser/" + this.params.taskId);
        } else {
            console.log("Route assignment/task/:taskId : waiting task data"); //TODO add a spinner
        }

    }, {
        controller: 'AssignmentController',
        name: 'assignment.calendar.task'
    }
);

//desactivation de la recherche par URL
//Router.route('/assignment/task/search/:searchInput', function () {
//    console.info("routing", '/assignment/task/search/' + this.params.searchInput);
//
//
//    var searchInput = this.params.searchInput;
//
//    if (searchInput === "") {
//        AssignmentReactiveVars.TaskFilter.set(AssignmentReactiveVars.defaultFilter);
//        this.redirect("/assignment");
//    } else {
//
//        $("#search_task_name").val(searchInput);
//
//        this.wait(Meteor.subscribe('tasks', {
//            name: searchInput
//        }));
//
//        if (this.ready()) {
//            console.info("task search for", searchInput);
//
//            AssignmentReactiveVars.TaskIndexFilter.set(searchInput);
//        } else {
//            console.log("waiting task data"); //TODO add a spinner
//        }
//    }
//
//
//}, {
//    controller: "AssignmentController",
//    name: "assignment.calendar.task.search"
//});

//desactivation de la recherche par URL
//Router.route('/assignment/user/search/:searchInput', function () {
//    console.info("routing", '/assignment/user/search/' + this.params.searchInput);
//
//
//    var searchInput = this.params.searchInput;
//
//    if (searchInput === "") {
//        AssignmentReactiveVars.UserFilter.set(AssignmentReactiveVars.defaultFilter);
//        this.redirect("/assignment");
//    } else {
//
//        $("#search_user_name").val(searchInput);
//        this.wait(Meteor.subscribe('users', {
//            name: searchInput
//        }));
//
//        if (this.ready()) {
//            console.info("user search for", searchInput);
//
//            AssignmentReactiveVars.UserIndexFilter.set(searchInput);
//        } else {
//            console.log("waiting user data"); //TODO add a spinner
//        }
//    }
//
//
//}, {
//    controller: "AssignmentController",
//    name: "assignment.calendar.user.search"
//});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_.html"></a></li><li><a href="AssignmentServiceClient.html">AssignmentServiceClient</a></li><li><a href="InjectDataServerService.html">InjectDataServerService</a></li><li><a href="Leaf.html">Leaf</a></li><li><a href="SecurityServiceClient.html">SecurityServiceClient</a></li><li><a href="SecurityServiceServer.html">SecurityServiceServer</a></li><li><a href="ServerAssignmentService.html">ServerAssignmentService</a></li><li><a href="ServerReferenceCollectionsService.html">ServerReferenceCollectionsService</a></li><li><a href="ServerTaskService.html">ServerTaskService</a></li><li><a href="ServerUserService.html">ServerUserService</a></li></ul><h3>Namespaces</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="EasySearch.html">EasySearch</a></li><li><a href="Enum.html">Enum</a></li><li><a href="Meteor%2520Methods.html">Meteor Methods</a></li><li><a href="Meteor_Publish.html">Meteor_Publish</a></li><li><a href="Route.html">Route</a></li><li><a href="Route.Assignment.html">Assignment</a></li><li><a href="Route.Assignment.taskToUser.html">taskToUser</a></li><li><a href="Route.Assignment.userToTask.html">userToTask</a></li><li><a href="Route.collectionReference.html">collectionReference</a></li><li><a href="Route.common.html">common</a></li><li><a href="Route.Task.html">Task</a></li><li><a href="Route.User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jun 20 2016 16:36:23 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
