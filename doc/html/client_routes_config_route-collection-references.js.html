<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/routes/config/route-collection-references.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/routes/config/route-collection-references.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {Schemas} from '../../../both/collection/model/SchemasHelpers'
import {SecurityServiceClient} from "../../../client/service/SecurityServiceClient"
/**
 * This namespace describes the auto-generated routes for all Collection references described belove
 * @memberOf Route
 * @namespace Route.collectionReference
 */

AllCollections = {
    Skills: Skills,
    Teams: Teams,
    Places: Places,
    AssignmentTerms: AssignmentTerms,
    GroupRoles: GroupRoles,
    EquipmentCategories: EquipmentCategories,
    Equipments: Equipments,
    WaterSupplies: WaterSupplies,
    WaterDisposals: WaterDisposals,
    PowerSupplies: PowerSupplies,
    EquipmentStorages: EquipmentStorages
};

var confMakerReactiveTables = [];

_.each(Schemas.references.options, function (referenceOptions) {
    var PLURAL_REFERENCE_URL = referenceOptions.PLURAL_REFERENCE_URL;
    var REFERENCE_URL = referenceOptions.REFERENCE_URL;
    var REFERENCE_COLLECTION_NAME = referenceOptions.REFERENCE_COLLECTION_NAME;
    var REFERENCE_LABEL = referenceOptions.REFERENCE_LABEL;


    //generate fields a partir de schema-references
    var schemaFields = Schemas.references[REFERENCE_COLLECTION_NAME]._schema;
    var reactiveTableFields = [];

    _.each(schemaFields,(field, key) => {
        if (key === "baseUrl" || key === "type") //pas moyen de faire mieux, SchemasCollection n'accepte aucun attribut en trop
            return;
        if(key.indexOf("Id") !== -1){ //it's a reference to another collection !
            reactiveTableFields.push(
                {
                    key: key,
                    label: field.label,
                    fnAdjustColumnSizing: true,
                    fn: function (teamId, Task) {
                        return AllCollections[key.split("_")[0]].findOne(teamId).name;
                    }
                }
            );
        } else {
            reactiveTableFields.push(
                {
                    key: key,
                    label: field.label,
                    fnAdjustColumnSizing: true
                }
            );
        }

    });

    //last column buttons
    reactiveTableFields.push({
        label: 'Actions',
        tmpl: Template.collectionReferenceButtons,
        fnAdjustColumnSizing: true
    });

    var item = {
        REFERENCE_URL: REFERENCE_URL,
        REFERENCE_LABEL: REFERENCE_LABEL,
        reactiveTableSettings: {
            collection: AllCollections[REFERENCE_COLLECTION_NAME],
            rowsPerPage: 5,
            showFilter: true,
            showRowCount: true,
            fields: reactiveTableFields
        }
    };
    confMakerReactiveTables.push(item);

    /**
     * @memberOf Route.collectionReference
     * @summary Display References Collection list (with filter and search soon)
     * @locus client
     * @name  '[REFERENCE_URL].list' /[PLURAL_REFERENCE_URL]
     */
    //get (list)
    Router.route('/' + PLURAL_REFERENCE_URL, function () {
            SecurityServiceClient.grantAccessToPage(Meteor.userId(), RolesEnum.CONFMAKER);
            this.render('referenceList', {
                data: item,
                to: 'mainContent'
            });
        },
        {name: REFERENCE_URL + '.list'}
    );

    /**
     * @memberOf Route.collectionReference
     * @summary Display the create References Collection form
     * @locus client
     * @name  '[REFERENCE_URL].create' /[REFERENCE_URL]
     */
//post
    Router.route('/' + REFERENCE_URL, function () {
            SecurityServiceClient.grantAccessToPage(Meteor.userId(), RolesEnum.CONFMAKER);
            this.render(REFERENCE_URL + '-insert', {
                data: {
                  options: referenceOptions
                },
                to: 'mainContent'
            });
        },
        {name: REFERENCE_URL + '.create'}
    );

    /**
     * @memberOf Route.collectionReference
     * @summary Display the update References Collection form
     * @locus client
     * @name  '[REFERENCE_URL].update' /[REFERENCE_URL]/_id
     */
//put
    Router.route('/' + REFERENCE_URL + '/:_id', function () {
            SecurityServiceClient.grantAccessToPage(Meteor.userId(), RolesEnum.CONFMAKER);
            var current = this.params._id;
            this.render(REFERENCE_URL + '-update', {
                data: {
                    collection: AllCollections[REFERENCE_COLLECTION_NAME],
                    document: AllCollections[REFERENCE_COLLECTION_NAME].findOne(current),
                },
                to: 'mainContent'
            });
        },
        {name: REFERENCE_URL + '.update'}
    );

});

/**
 * @memberOf Route.collectionReference
 * @summary Display the conf homepage
 * @locus client
 * @name  'confMaker' /confMaker
 */
//get (list)
Router.route('/conf-maker', function () {
        SecurityServiceClient.grantAccessToPage(Meteor.userId(), RolesEnum.CONFMAKER);
        this.render('confMaker', {
            data: {
                confMakerReactiveTables : confMakerReactiveTables
            },
            to: 'mainContent'
        });
    },
    {name: 'confMaker'}
);

Template.confMaker.rendered = function(){
    $('#conf-maker-wrapper').collapsible({
    });
};


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_.html"></a></li><li><a href="AssignmentServiceClient.html">AssignmentServiceClient</a></li><li><a href="InjectDataServerService.html">InjectDataServerService</a></li><li><a href="Leaf.html">Leaf</a></li><li><a href="SecurityServiceClient.html">SecurityServiceClient</a></li><li><a href="SecurityServiceServer.html">SecurityServiceServer</a></li><li><a href="ServerAssignmentService.html">ServerAssignmentService</a></li><li><a href="ServerReferenceCollectionsService.html">ServerReferenceCollectionsService</a></li><li><a href="ServerTaskService.html">ServerTaskService</a></li><li><a href="ServerUserService.html">ServerUserService</a></li></ul><h3>Namespaces</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="EasySearch.html">EasySearch</a></li><li><a href="Enum.html">Enum</a></li><li><a href="Meteor%2520Methods.html">Meteor Methods</a></li><li><a href="Meteor_Publish.html">Meteor_Publish</a></li><li><a href="Route.html">Route</a></li><li><a href="Route.Assignment.html">Assignment</a></li><li><a href="Route.Assignment.taskToUser.html">taskToUser</a></li><li><a href="Route.Assignment.userToTask.html">userToTask</a></li><li><a href="Route.collectionReference.html">collectionReference</a></li><li><a href="Route.common.html">common</a></li><li><a href="Route.Task.html">Task</a></li><li><a href="Route.User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jun 20 2016 16:36:23 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
