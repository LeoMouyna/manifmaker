<template name="taskTimeSlots">

    {{reactiveConstructor}}

    <div class="col-md-12">
        {{>AssignmentTermSelectComponent}}
    </div>

    <div class="col-md-8">
        {{> EditTimeSlotCalendarComponent task=taskData parentInstance=self timeSlotTemplate="updateTimeSlotCalendar" class="updateTimeSlotCalendar"}}
    </div>

    <div class="col-md-4">
        <div class="col-md-12 add-time-slot">
            <div class="row">

                {{#unless isTimeSlotsReadOnly}}
                    {{#if isTimeSlotUpdated.get}}
                        <label>Update time slot</label><i class="duplicate-button">copy</i><i class="material-icons delete-button">delete</i> | <i class="material-icons add-button">add</i>
                    {{/if}}

                    {{#if isTimeSlotCreated.get}}
                        <label>Create time slot</label><i class="material-icons done-button">done</i><i class="material-icons clear-button">clear_all</i>
                    {{/if}}

                    {{#unless isTimeSlotCreated.get}}
                        {{#unless isTimeSlotUpdated.get}}
                            <label>Select or create a time slot</label> <i class="material-icons add-button">add</i>
                        {{/unless}}
                    {{/unless}}
                {{else}}
                    <label>Select a time slot</label>
                {{/unless}}

            </div>
            {{#if isTimeSlotUpdated.get}}
                <div id="add-time-slot-form" class="row">
                    <div class="row">
                        From * {{>DateTimePickerComponent class="date-time-picker-update-time-slot" date=currentTimeSlot.start updateDateCallback=updateTimeSlotStartDate readOnly=isTimeSlotsReadOnly}}
                        to* {{>DateTimePickerComponent  class="date-time-picker-update-time-slot" date=currentTimeSlot.end updateDateCallback=updateTimeSlotEndDate readOnly=isTimeSlotsReadOnly}}
                    </div>
                    <div class="row error-holder">
                        {{updatetimeSlotDatesError}}
                    </div>
                    <div class="row people-need">
                        <label>People needs</label>

                        <div class="row">
                            {{#each currentTimeSlotPeopleNeededMerged}}

                                <div class="row">
                                    <div class="col-md-3">
                                        <span>{{count}}</span>
                                        {{#unless isTimeSlotsReadOnly}}
                                            <i class="mdi mdi-delete mdi-inline delete" data-peopleneededid="{{this._id}}"></i>
                                            {{#unless userId}}<i class="mdi mdi-content-copy mdi-inline duplicate" data-peopleneededid="{{this._id}}"></i>{{/unless}}
                                        {{/unless}}
                                    </div>
                                    <div class="col-md-9">
                                        {{#if userId}}
                                            {{> SingleNonMandatorySelectComponent withoutLabel=true title="Specific user need"
                                            optionCollection="Users" optionValueName="name" optionCollectionIndex="UsersIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="userId"
                                            pathWithArray=pathWithArrayPeopleNeeded
                                            updateCallback=updatePeopleNeedCallback
                                            readOnly=isTimeSlotsReadOnly}}
                                        {{/if}}
                                        {{#if teamId}}
                                            {{> SingleNonMandatoryBulkSelectComponent withoutLabel=true title="Specific a team need"
                                            optionCollection="Teams" optionValueName="name" optionCollectionIndex="TeamsIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="teamId"
                                            bulkPeopleNeededIds=bulkPeopleNeededIds
                                            updateCallback=updatePeopleNeedCallback
                                            readOnly=isTimeSlotsReadOnly}}
                                        {{/if}}
                                        {{#if skills}}
                                            {{> MultipleNonMandatoryBulkSelectComponent withoutLabel=true title="Specific some needed skills"
                                            optionCollection="Skills" optionValueName="label" optionCollectionIndex="SkillsIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="skills"
                                            bulkPeopleNeededIds=bulkPeopleNeededIds
                                            updateCallback=updatePeopleNeedCallback
                                            readOnly=isTimeSlotsReadOnly}}
                                        {{/if}}
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                        <div class="row error-holder">
                            {{updatePeopleNeededError}}
                        </div>
                    </div>

                    <div class="row people-need-assigned">
                        <label>People needs already assigned</label>

                        <div class="row">
                            {{#each currentTimeSlotPeopleNeededMerged true}}

                                <div class="row">
                                    <div class="col-md-3">
                                        <span>{{count}}</span>
                                    </div>
                                    <div class="col-md-9">
                                        {{#if userId}}
                                            {{> SingleNonMandatorySelectComponent withoutLabel=true title="Specific user need"
                                            optionCollection="Users" optionValueName="name" optionCollectionIndex="UsersIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="userId"
                                            pathWithArray=pathWithArrayPeopleNeeded
                                            readOnly=true}}
                                        {{/if}}
                                        {{#if teamId}}
                                            {{> SingleNonMandatoryBulkSelectComponent withoutLabel=true title="Specific a team need"
                                            optionCollection="Teams" optionValueName="name" optionCollectionIndex="TeamsIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="teamId"
                                            bulkPeopleNeededIds=bulkPeopleNeededAssignedIds
                                            readOnly=true}}
                                        {{/if}}
                                        {{#if skills}}
                                            {{> MultipleNonMandatoryBulkSelectComponent withoutLabel=true title="Specific some needed skills"
                                            optionCollection="Skills" optionValueName="label" optionCollectionIndex="SkillsIndex"
                                            updateCollection="Tasks" updateItemId=taskData._id
                                            updateItemPath="skills"
                                            bulkPeopleNeededIds=bulkPeopleNeededAssignedIds
                                            readOnly=true}}
                                        {{/if}}
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                        <div class="row error-holder">
                            {{updatePeopleNeededError}}
                        </div>
                    </div>

                </div>
            {{/if}}

            {{#if isTimeSlotCreated.get}}
                <div id="create-time-slot-form" class="row">
                    <div class="row">
                        From * {{>DateTimePickerComponent class="date-time-picker-update-time-slot" date=createTimeSlotDefaultStartDate.get updateDateCallback=updateTimeSlotStartDate}}
                        to* {{>DateTimePickerComponent  class="date-time-picker-update-time-slot" date=createTimeSlotDefaultEndDate.get updateDateCallback=updateTimeSlotEndDate}}
                    </div>
                    <div class="row error-holder">
                        {{updatetimeSlotDatesError}}
                    </div>
                </div>
            {{/if}}
        </div>

        {{#unless isTimeSlotsReadOnly}}
            {{#if isTimeSlotUpdated.get}}
                <div class="col-md-12 add-people-need">
                    <div class="row">
                        <label>Add a people need</label>{{#if displayAddPeopleNeedForm}}<i class="material-icons done-button">done</i><i class="material-icons clear-button">clear_all</i>{{else}}<i class="material-icons add-button">add</i>{{/if}}
                    </div>
                    {{#if displayAddPeopleNeedForm}}
                        <div id="add-people-need-form" class="row">
                            <div class="col-md-6">
                                {{> SingleNonMandatorySelectComponent selectLabel="Need a specific team" title="Select a needed team"
                                optionCollection="Teams" optionValueName="name" optionCollectionIndex="TeamsIndex" nothingSelectedLabel="No team"
                                updateCollection="TempCollection" updateItemId=tempPeopleNeedId updateItemPath="teamId"
                                nothingSelectedLabel="None yet" quickSelectLabel="assign to your team" quickSelectId=currentUserTeamId
                                }}
                            </div>
                            <div class="col-md-6">
                                {{> MultipleNonMandatorySelectComponent selectLabel="Need of set of skills" title="Select needed skills"
                                optionCollection="Skills" optionValueName="label" optionCollectionIndex="SkillsIndex" nothingSelectedLabel="No skills"
                                updateCollection="TempCollection" updateItemId=tempPeopleNeedId updateItemPath="skills"
                                }}
                            </div>
                            <div class="col-md-6">
                                {{> SingleNonMandatorySelectComponent title="Select a needed user" selectLabel="Need a specific user"
                                optionCollection="Users" optionValueName="name" optionCollectionIndex="UsersIndex"
                                updateCollection="TempCollection" updateItemId=tempPeopleNeedId updateItemPath="userId"
                                nothingSelectedLabel="No one" quickSelectLabel="assign to yourself" quickSelectId=currentUserId
                                }}
                            </div>
                        </div>
                        <div class="row error-holder">
                            {{createPeopleNeededError}}
                        </div>
                    {{/if}}
                </div>
            {{/if}}
        {{/unless}}
    </div>
</template>

<template name="updateTimeSlotCalendar">
    <div class="creneau {{state}} {{#if equals currentTimeSlot._id this._id}}currentTimeSlot{{/if}}" data-timeslotdid="{{this._id}}" style="height: {{height}};">
        <div class="on-calendar">
            <div class="col-xs-10 no-padding creneau-to-affect">

                {{#each getPeopleNeededMerged _id}}
                    <p class="col-md-2 no-padding people-need" title="
                        {{#if userId}}
                        {{count}} particular {{#if equals count 1}}person is{{else}}people are{{/if}} needed
                        {{else}}
                        {{count}} need{{#unless equals count 1}}s{{/unless}} of :{{#if teamId}} a particular team{{#if skills}}, {{/if}}{{/if}}{{#each skills}}{{#unless equals @index 0}}and {{/unless}} {{skillLabel}} (skill) {{/each}}
                    {{/if}}">

                        <p class="col-md-12 no-padding creneau-header">
                            {{#if isMore 5 @index}}
                                {{count}}
                            {{/if}}
                        </p>

                        {{#if isMore 5 @index}}
                            {{#if userId }}
                                <i class="mdi mdi-account"></i>
                                <br>{{/if}}
                            {{#if teamId}}
                                <i class="mdi mdi-account-multiple"></i>
                                <br>{{/if}}
                            {{#each skills}}
                                <i class="mdi mdi-android-studio"></i>
                                <br>
                            {{/each}}
                        {{else}}
                            {{#if equals @index 5}}
                                <b>...</b>
                            {{/if}}
                        {{/if}}

                    </p>
                {{/each}}

            </div>
            <div class="col-xs-2 no-padding creneau-affected" title="
                {{getAlreadyAssignedPeopleNeedCount _id}} {{#if isMore getAlreadyAssignedPeopleNeedCount _id 1}}people{{else}}person{{/if}} already affected
                ">
                <p class="no-padding creneau-header">
                    <div>{{getAlreadyAssignedPeopleNeedCount _id}}</div>
                </p>
                <p class="col-md-12 no-padding people-need">
                    <i class="mdi mdi-calendar-check"></i>
                </p>
            </div>



        </div>
    </div>
</template>
